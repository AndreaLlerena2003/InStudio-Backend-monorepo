version: '3.8'

services:


  kafdrop:
    image: obsidiandynamics/kafdrop
    restart: "no"
    ports:
      - "9000:9000"
    environment:
      KAFKA_BROKERCONNECT: "kafka:29092"
    depends_on:
      - "kafka"
  
  kafka:
    image: obsidiandynamics/kafka
    restart: "no"
    ports:
      - "2181:2181"
      - "9092:9092"
    environment:
      KAFKA_LISTENERS: "INTERNAL://:29092,EXTERNAL://:9092"
      KAFKA_ADVERTISED_LISTENERS: "INTERNAL://kafka:29092,EXTERNAL://localhost:9092"
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: "INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT"
      KAFKA_INTER_BROKER_LISTENER_NAME: "INTERNAL"
      KAFKA_ZOOKEEPER_SESSION_TIMEOUT: "6000"
      KAFKA_RESTART_ATTEMPTS: "10"
      KAFKA_RESTART_DELAY: "5"
      ZOOKEEPER_AUTOPURGE_PURGE_INTERVAL: "0"

  mongodb-booking-service:
    image: docker.io/bitnami/mongodb:5.0  
    environment:
      - MONGODB_ROOT_PASSWORD=password123  
    volumes:
      - 'mongodb-booking-service_data:/bitnami/mongodb'  
    ports:
      - '27017:27017'  

  mongodb-offers-service:
    image: docker.io/bitnami/mongodb:5.0  
    environment:
      - MONGODB_ROOT_PASSWORD=password123
    volumes:
      - 'mongodb-offers-service_data:/bitnami/mongodb'  
    ports:
      - '27018:27017'  

  admin-service-1:
    image: postgres:14
    environment:
      POSTGRES_DB: admin-service
      POSTGRES_USER: user1
      POSTGRES_PASSWORD: password1
    volumes:
      - 'admin-service-1_data:/var/lib/postgresql/data'
    ports:
      - '5632:5432'

  user-service-2:
    image: postgres:14
    environment:
      POSTGRES_DB: user-service
      POSTGRES_USER: user2
      POSTGRES_PASSWORD: password2
    volumes:
      - 'user-service-2_data:/var/lib/postgresql/data'
    ports:
      - '5633:5432'

  auth-service-3:
    image: postgres:14
    environment:
      POSTGRES_DB: auth-service
      POSTGRES_USER: user3
      POSTGRES_PASSWORD: password3
    volumes:
      - 'auth-service-3_data:/var/lib/postgresql/data'
    ports:
      - '5634:5432'

  payments-service-5:
    image: postgres:14
    environment:
      POSTGRES_DB: payments-service
      POSTGRES_USER: user5
      POSTGRES_PASSWORD: password5
    volumes:
      - 'payments-service-5_data:/var/lib/postgresql/data'
    ports:
      - '5639:5432'

volumes:
  mongodb-booking-service_data:
    driver: local  
  mongodb-offers-service_data:
    driver: local  
  admin-service-1_data:
    driver: local
  user-service-2_data:
    driver: local
  auth-service-3_data:
    driver: local
  payments-service-5_data:
    driver: local
